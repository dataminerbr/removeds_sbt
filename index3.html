<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Programação MSW</title>
  <style>
    body {
      background-color: #121212;
      color: white;
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
    }
    h1 {
      color: red;
      text-align: center;
      margin-bottom: 30px;
    }
    .date-group {
      background-color: #1c1c1c;
      border: 1px solid #333;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 30px;
    }
    .date-title {
      font-size: 22px;
      color: #f44336;
      margin-bottom: 15px;
      border-bottom: 1px solid #444;
      padding-bottom: 5px;
    }
    .channel-group {
      background-color: #252525;
      border-left: 5px solid #2196f3;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
    }
    .channel-header {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .channel-logo {
      height: 40px;
      margin-right: 10px;
    }
    .channel-title {
      font-size: 18px;
      font-weight: bold;
    }
    .schedule {
      background-color: #2e2e2e;
      border-radius: 8px;
      padding: 10px;
      margin: 8px 0;
      position: relative;
    }
    .formatted-time {
      font-size: 14px;
      color: #bbbbbb;
      margin-bottom: 5px;
    }
    .progress-bar-container {
      background-color: #444;
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 8px;
    }
    .progress-bar {
      background-color: #f44336;
      height: 100%;
    }
#content {
  max-width: 1400px; /* aumente aqui a largura */
  margin: 0 auto;
  padding: 0 20px; /* opcional: espaço interno lateral */
}

  /* Modal estilo Claro TV+ */
  #modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.9);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }

  #modal-content {
    width: 600px;
    max-width: 90%;
    background: #111;
    color: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 0 20px #000;
    font-family: sans-serif;
  }

.modal-header {
  background-size: cover;
  background-position: center;
  height: 320px; /* Aumentei de 200px para 320px */
  position: relative;
  border-bottom: 1px solid #222; /* opcional: separa visualmente a imagem do conteúdo */
}

.modal-body {
  padding: 30px 20px; /* um pouco mais de padding vertical */
}

.modal-meta {
  margin: 15px 0; /* espaço maior entre título/meta e descrição */
}
  .modal-header::after {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
  }



  .modal-title {
    font-size: 20px;
    font-weight: bold;
  }

  .modal-description {
    font-size: 15px;
    margin-top: 10px;
  }

  .close-modal {
    position: absolute;
    top: 10px; right: 10px;
    background: transparent;
    color: white;
    font-size: 24px;
    border: none;
    cursor: pointer;
    z-index: 2;
  }
  
  </style>
</head>
<body>
  <h1>Programação MSW</h1>
  <div style="text-align:center; margin-bottom: 20px;">
  <strong>Legenda de Cores:</strong><br>
  <span style="color: green;">● Chaves (ao vivo)</span> &nbsp;
  <span style="color: red;">● Chapolin (ao vivo)</span> &nbsp;
  <span style="color: orange;">● Reprise</span>
</div>

  <div id="content">Carregando programação...</div>
  
<div id="modal">
  <div id="modal-content">
    <div class="modal-header" id="modal-header">
      <button class="close-modal" onclick="document.getElementById('modal').style.display='none'">✖</button>
    </div>
    <div class="modal-body">
      <div class="modal-title" id="modal-title"></div>
      <div class="modal-meta" id="modal-meta"></div>
      <div class="modal-description" id="modal-description"></div>
    </div>
  </div>
</div>

 <script>
function gerarURL() {
  const agora = Math.floor(Date.now() / 1000);
  const startTime = agora - (4 * 60 * 60); // 4h atrás
  const endTime = agora + (10 * 365 * 24 * 60 * 60); // 10 anos

  return `https://www.clarotvmais.com.br/avsclient/1.2/epg/livechannels?types=&channelIds=98&startTime=${startTime}&endTime=${endTime}&onlyUserContent=&location=FLORIANOPOLIS,SANTA%20CATARINA&channel=PCTV`;
}

// Exemplo de uso:
const API_URL = gerarURL();

  async function fetchData() {
    try {
      const response = await fetch(API_URL);
      const data = await response.json();
      renderData(data.response.liveChannels[0]);
    } catch (error) {
      document.getElementById('content').innerHTML = `<p style="color:red;">Erro ao carregar dados: ${error.message}</p>`;
    }
  }

async function renderData(channel) {
  const container = document.getElementById('content');
  container.innerHTML = '';

  const now = Math.floor(Date.now() / 1000);

  //const episodeData = await fetch("https://raw.githubusercontent.com/dataminerbr/removeds_sbt/refs/heads/main/ch_msw.json")
  //  .then(response => response.json())
  //  .catch(err => {
  //    console.error("Erro ao carregar os dados dos episódios:", err);
  //    return { chaves_msw: [], chapolin_msw: [] };
  //  });
  
    const episodeData = {
      chaves_msw: [ 
    {
      "numero": "1",
      "titulo": "Balões / Boas Festas"
    },
    {
      "numero": "2",
      "titulo": "A Lata De Lixo / Pintores Amadores / O Homem Das Mil Caras"
    },
    {
      "numero": "3",
      "titulo": "Moedas / Dando Bolo / Dois Ladrões"
    },
    {
      "numero": "4",
      "titulo": "A Troca / O Dedo-Duro / O Surto de Catapora"
    },
    {
      "numero": "5",
      "titulo": "Ladrão Que Rouba Ladrão / Remédio Duro De Engolir / Quem Semeia Moeda"
    },
    {
      "numero": "6",
      "titulo": "Quem Canta, Seus Males Espanca / O Doente"
    },
    {
      "numero": "7",
      "titulo": "O Despejo / O Piquenique Voador/ Doutor Chapatin"
    },
    {
      "numero": "8",
      "titulo": "Como Sujar A Roupa Do Quico / Ajudem-Se Uns Aos Outros / À Procura De Desemprego"
    },
    {
      "numero": "9",
      "titulo": "Uma Visita Muito Importante / Uma Vizinha – Parte 2 / Os Contrabandistas De Joias"
    },
    {
      "numero": "10",
      "titulo": "Beijinhos / Doutor Chapatin / O Mosquito"
    },
    {
      "numero": "11",
      "titulo": "O Cofre / Marteladas / Zarabatana e Chumbinhos"
    },
    {
      "numero": "12",
      "titulo": "O Mistério Dos Peixinhos / O Ensaio"
    },
    {
      "numero": "13",
      "titulo": "O Que Fazer Quando Um Ladrão Entra Em Casa? / A Chirimoia"
    },
    {
      "numero": "14",
      "titulo": "A Bola / Grito De Independência / Este Varal É Meu! / Por Uma Mulher Formosa"
    },
    {
      "numero": "15",
      "titulo": "As Apostas / Escolinha Da Chiquinha / Os Ladrões"
    },
    {
      "numero": "16",
      "titulo": "Oras, Bolas"
    },
    {
      "numero": "17",
      "titulo": "O Mendigo / As Crianças Faltam À Escola"
    },
    {
      "numero": "18",
      "titulo": "O Leiteiro / Quem Será O Novo Chefe?"
    },
    {
      "numero": "19",
      "titulo": "Barba, Cabelo... E Graxa! / Campanha México 73"
    },
    {
      "numero": "20",
      "titulo": "Agenta Zero Zero Seta / Barquinhos De Papel"
    },
    {
      "numero": "21",
      "titulo": "O Marujo Enjoado / Sustos Na Vila"
    },
    {
      "numero": "22",
      "titulo": "A Louca Da Escadaria – Parte 1"
    },
    {
      "numero": "23",
      "titulo": "A Festa Da Boa Vizinhança"
    },
    {
      "numero": "24",
      "titulo": "As Festas De Independência"
    },
    {
      "numero": "25",
      "titulo": "Caçando Insetos"
    },
    {
      "numero": "26",
      "titulo": "Uma Aula De Canto – Parte 2 / Quem Brinca Com Fogo Faz Pipi Na Cama"
    },
    {
      "numero": "27",
      "titulo": "O Cãozinho da Bruxa do 71"
    },
    {
      "numero": "28",
      "titulo": "Bebês Versus Compras"
    },
    {
      "numero": "29",
      "titulo": "Seu Madruga Sapateiro"
    },
    {
      "numero": "30",
      "titulo": "Jogando Bola"
    },
    {
      "numero": "31",
      "titulo": "Os Atropelados, Segunda Parte"
    },
    {
      "numero": "32",
      "titulo": "A Festa Da Amizade"
    },
    {
      "numero": "33",
      "titulo": "Natal, Noite De Paz / Uma Refeição Indigesta"
    },
    {
      "numero": "34",
      "titulo": "O Ano Novo De Chaves"
    },
    {
      "numero": "35",
      "titulo": "Com Quantos Ovos Se Faz Um Bolo?"
    },
    {
      "numero": "36",
      "titulo": "Um Porquinho De Cada Vez"
    },
    {
      "numero": "37",
      "titulo": "Os Campeões De Ioiô"
    },
    {
      "numero": "38",
      "titulo": "Muito Azar Na Sorte Grande"
    },
    {
      "numero": "39",
      "titulo": "O Mistério Dos Pratos Desaparecidos – Parte 1"
    },
    {
      "numero": "40",
      "titulo": "A Volta Dos Espíritos Zombeteiros – Parte 2"
    },
    {
      "numero": "41",
      "titulo": "Um Triângulo Amoroso"
    },
    {
      "numero": "42",
      "titulo": "A Doença Do Quico"
    },
    {
      "numero": "43",
      "titulo": "A Troca De Chapéus"
    },
    {
      "numero": "44",
      "titulo": "A Cruz Vermelha"
    },
    {
      "numero": "45",
      "titulo": "Os Balões do Quico"
    },
    {
      "numero": "46",
      "titulo": "Quem Baixa As Calças, Fica Sem Elas / Quem Convida, Paga"
    },
    {
      "numero": "47",
      "titulo": "O Ladrão"
    },
    {
      "numero": "48",
      "titulo": "O Festival da Burrice"
    },
    {
      "numero": "49",
      "titulo": "O Homem Invisível"
    },
    {
      "numero": "50",
      "titulo": "O Caçador de Lagartixas"
    },
    {
      "numero": "51",
      "titulo": "Como Sujar Uma Roupa de Festa"
    },
    {
      "numero": "52",
      "titulo": "As Férias dos Folgados / A Casinha do Chaves"
    },
    {
      "numero": "53",
      "titulo": "Quem Dorme Com Criança, Acorda Molhado"
    },
    {
      "numero": "54",
      "titulo": "Gente Sim, Animal Não"
    },
    {
      "numero": "55",
      "titulo": "Um Rato na Contramão"
    },
    {
      "numero": "56",
      "titulo": "Tempestade em Balde D'Água"
    },
    {
      "numero": "57",
      "titulo": "Seu Madruga Carpinteiro / Os Dois Ladrões"
    },
    {
      "numero": "58",
      "titulo": "Vendedor de Refrescos"
    },
    {
      "numero": "59",
      "titulo": "Mais Vale Uma Noite Bem Dormida Que Uma Boa Comida"
    },
    {
      "numero": "60",
      "titulo": "Nada Como Ser Um Expert No Assunto - Parte 1 / O Feitiço Contra O Feiticeiro?"
    },
    {
      "numero": "61",
      "titulo": "Nada Como Ser Um Expert No Assunto - Parte 2"
    },
    {
      "numero": "62",
      "titulo": "O Despejo do Grande Campeão"
    },
    {
      "numero": "63",
      "titulo": "Uma Lição de Boxe"
    },
    {
      "numero": "64",
      "titulo": "A Briga dos Pombinhos"
    },
    {
      "numero": "65",
      "titulo": "Os Gesseiros"
    },
    {
      "numero": "66",
      "titulo": "Ama O Teu Inimigo / Cyrano De Bergerac"
    },
    {
      "numero": "67",
      "titulo": "Isto Merece Um Prêmio! / Dom Quixote"
    },
    {
      "numero": "68",
      "titulo": "O Calo Do Senhor Barriga / Napoleão Bonaparte"
    },
    {
      "numero": "69",
      "titulo": "Discos Voadores"
    },
    {
      "numero": "70",
      "titulo": "Viva A Independência"
    },
    {
      "numero": "71",
      "titulo": "Seu Madruga Pega No Batente – Parte 1"
    },
    {
      "numero": "72",
      "titulo": "Seu Madruga Larga O Batente – Parte 2 / História De Pianista"
    },
    {
      "numero": "73",
      "titulo": "Uma Troca Muito Justa – Parte 3"
    },
    {
      "numero": "74",
      "titulo": "O Primo Do Seu Madruga"
    },
    {
      "numero": "75",
      "titulo": "Tocando Violão"
    },
    {
      "numero": "76",
      "titulo": "Lavagem Completa"
    },
    {
      "numero": "77",
      "titulo": "Chiquinha, O Terror Do Cortiço"
    },
    {
      "numero": "78",
      "titulo": "A Fonte Dos Desejos"
    },
    {
      "numero": "79",
      "titulo": "Brincando De Bombeiros"
    },
    {
      "numero": "80",
      "titulo": "O Belo Adormecido"
    },
    {
      "numero": "81",
      "titulo": "Posso Não Emprestar O Que É Meu, Mas Dos Outros…"
    },
    {
      "numero": "82",
      "titulo": "O Aniversário Do Quico"
    },
    {
      "numero": "83",
      "titulo": "Era Uma Vez Um Gato"
    },
    {
      "numero": "84",
      "titulo": "Era Uma Vez Um Gato – Parte 2"
    },
    {
      "numero": "85",
      "titulo": "A Morte do Seu Madruga"
    },
    {
      "numero": "86",
      "titulo": "Guerra É Guerra / Os Ladrões"
    },
    {
      "numero": "87",
      "titulo": "Ser Professor É Padecer No Inferno"
    },
    {
      "numero": "88",
      "titulo": "Jogando Futebol"
    }
   ],
      chapolin_msw: [
    {
      "numero": "1",
      "titulo": "A Casa Mal Assombrada / Um Boneco Muito Vivo"
    },
    {
      "numero": "2",
      "titulo": "O Quarto Errado / O Prêmio Da Loteria / Os Duendezinhos"
    },
    {
      "numero": "3",
      "titulo": "O Exame / O Descobrimento da Tribo Perdida"
    },
    {
      "numero": "4",
      "titulo": "Bloqueando a Entrada / Ator de Araque / Prometida"
    },
    {
      "numero": "5",
      "titulo": "A Mão do Bandido / A Explosão / Por uma Fatia de Melancia"
    },
    {
      "numero": "6",
      "titulo": "O Bandido Mata Fácil / Parabéns, Sargento! / O Julgamento"
    },
    {
      "numero": "7",
      "titulo": "A Fronteira / Um Passageiro Encrequeiro / Os Fantasmas"
    },
    {
      "numero": "8",
      "titulo": "O Roubo das Maçãs / A Fuga / Visita ao Museu"
    },
    {
      "numero": "9",
      "titulo": "Conde Terra Nova/Doutor Chapatin/O Vampiro"
    },
    {
      "numero": "10",
      "titulo": "Arruaceiros / Os Prisioneiros / Jantar Executivo 2"
    },
    {
      "numero": "11",
      "titulo": "Confusão No Celeiro / Encontro Às Escuras / Garçom Desastrado"
    },
    {
      "numero": "12",
      "titulo": "Operação De Salvamento / Problemas De Peso / A Lenda Da Chorona"
    },
    {
      "numero": "13",
      "titulo": "Um Aluno e Tanto / Presente de Grego"
    },
    {
      "numero": "14",
      "titulo": "A Lata de Suco / Trapaças no Restaurante / O Índio Pele Vermelha"
    },
    {
      "numero": "15",
      "titulo": "Uma Investigação Perigosa"
    },
    {
      "numero": "16",
      "titulo": "O Cão Raivoso"
    },
    {
      "numero": "17",
      "titulo": "O Debilitador Potencial"
    },
    {
      "numero": "18",
      "titulo": "Fila e Fichas no Hospital / Duas Vezes Chapolin"
    },
    {
      "numero": "19",
      "titulo": "Para Fugir da Prisão"
    },
    {
      "numero": "20",
      "titulo": "Médicos Birutas / O Minidisco Voador"
    },
    {
      "numero": "21",
      "titulo": "Dando um Fim no Chapolin"
    },
    {
      "numero": "22",
      "titulo": "Uma Múmia Bastante Egípcia"
    },
    {
      "numero": "23",
      "titulo": "A Casa de Chá do Luar de 8 de agosto de 1984 / A Autópsia"
    },
    {
      "numero": "24",
      "titulo": "O Pistoleiro Da Marreta Biônica / Infelizmente Perdemos o Avião, Graças a Deus"
    },
    {
      "numero": "25",
      "titulo": "Um Hotel Nada Agradável"
    },
    {
      "numero": "26",
      "titulo": "O Anel de Brilhantes"
    },
    {
      "numero": "27",
      "titulo": "O Espião Invisível"
    },
    {
      "numero": "28",
      "titulo": "Um Miado ao Cair da Noite"
    },
    {
      "numero": "29",
      "titulo": "Quando Os Brinquedos Voam"
    },
    {
      "numero": "30",
      "titulo": "O Gato e o Chimpanzé / Um Defunto Bastante Morto"
    },
    {
      "numero": "31",
      "titulo": "Proibido Mexer Com Bombas Em Horas De Serviço"
    },
    {
      "numero": "32",
      "titulo": "Injeção, Não! / O Paciente Teimoso"
    },
    {
      "numero": "33",
      "titulo": "O Bandido"
    },
    {
      "numero": "34",
      "titulo": "Livrai-nos dos Metidos, Senhor / E Livrai-nos Também dos Distraídos"
    },
    {
      "numero": "35",
      "titulo": "A Pérola / Um Robô Desparafusado"
    },
    {
      "numero": "36",
      "titulo": "Um Brinde aos Recém Casados/Os Microfones Ocultos"
    },
    {
      "numero": "37",
      "titulo": "A Invasão dos Marcianos"
    },
    {
      "numero": "38",
      "titulo": "O Caso Dos Dois Homens Que Eram Tão Parecidos Que Eram Idênticos, Principalmente Um Deles"
    },
    {
      "numero": "39",
      "titulo": "A Bela Adormecida Era Um Senhor Muito Feio - Parte 2"
    },
    {
      "numero": "40",
      "titulo": "Os Búfalos, os Caçadores e Outros Animais"
    },
    {
      "numero": "41",
      "titulo": "Chapolin Vemos, Cérebro Não Sabemos"
    },
    {
      "numero": "42",
      "titulo": "O Extrato De Energia Volátil"
    },
    {
      "numero": "43",
      "titulo": "A Revólver Dado, Não Se Olham As Balas"
    },
    {
      "numero": "44",
      "titulo": "Expedição Arqueológica"
    },
    {
      "numero": "45",
      "titulo": "Paquera à Moda Antiga/Em Fotos Pequeninas, o Chapolin Aparece de Corpo Inteiro"
    },
    {
      "numero": "46",
      "titulo": "Ladrão que Rouba Ladrão Está Traindo o Sindicato"
    },
    {
      "numero": "47",
      "titulo": "Dom Chapolin de La Mancha"
    },
    {
      "numero": "48",
      "titulo": "A Casa Dada Não Se Contam Os Fantasmas"
    },
    {
      "numero": "49",
      "titulo": "Goteiras / Silêncio no Estúdio!"
    },
    {
      "numero": "50",
      "titulo": "Um Abrigo para o Doutor Chapatin / A Corneta Paralisadora"
    },
    {
      "numero": "51",
      "titulo": "O Relógio Perdido / Ratos Vemos, Intenções Não Sabemos"
    },
    {
      "numero": "52",
      "titulo": "O Regresso da Corneta Paralisadora"
    },
    {
      "numero": "53",
      "titulo": "Uma Conferência sobre o Chapolin"
    },
    {
      "numero": "54",
      "titulo": "Por favor, É Aqui que Vive um Morto?"
    },
    {
      "numero": "55",
      "titulo": "Presídio de Segurança Mínima"
    },
    {
      "numero": "56",
      "titulo": "Festival de Fantasias - Parte 1"
    },
    {
      "numero": "57",
      "titulo": "Festival de Fantasias - Parte 2"
    },
    {
      "numero": "58",
      "titulo": "Não Confunda \"A Casa Está Caindo de Velha\" com \"A Velha Está Caindo da Casa\""
    },
    {
      "numero": "59",
      "titulo": "Não Se Enrugue, Couro Velho, Que Te Quero Para Tambor"
    },
    {
      "numero": "60",
      "titulo": "O Anel Mágico"
    },
    {
      "numero": "61",
      "titulo": "Remédios das Dores da Angústia"
    },
    {
      "numero": "62",
      "titulo": "O Bebê Jupiteriano"
    },
    {
      "numero": "63",
      "titulo": "A Maldição Da Bola De Cristal"
    },
    {
      "numero": "64",
      "titulo": "Precisamos Fechar! / Não me Amole, Mosquito!"
    },
    {
      "numero": "65",
      "titulo": "Mão Negra / A Guerra de Secessão"
    },
    {
      "numero": "66",
      "titulo": "O Verniz Invisibilizador / A Tragédia"
    },
    {
      "numero": "67",
      "titulo": "O Soldado Atrapalhado/Depois de Jogarem o Chapolin, Tapem o Poço"
    },
    {
      "numero": "68",
      "titulo": "Uma Coisa é Ser Sansão e Outra é Usar Peruca"
    },
    {
      "numero": "69",
      "titulo": "Ainda que a Cela Seja de Ouro, Não Deixa de ser Chato Ficar Preso"
    },
    {
      "numero": "70",
      "titulo": "O Extraterrestre / Uma Pedra no Caminho"
    },
    {
      "numero": "71",
      "titulo": "O Gorila Sai Da Jaula / Doutor Chapatin No Banco"
    },
    {
      "numero": "72",
      "titulo": "Uma Herança Explosiva"
    },
    {
      "numero": "73",
      "titulo": "Selva"
    },
    {
      "numero": "74",
      "titulo": "De Médico, Chapolin e Louco Todo Mundo Tem Um Pouco"
    },
    {
      "numero": "75",
      "titulo": "O Idioma do Amor / Vagabundos Nós Vemos, Trabalhos Não Sabemos"
    },
    {
      "numero": "76",
      "titulo": "Tostão Atrai Tostão... Mas Também Ladrão"
    },
    {
      "numero": "77",
      "titulo": "Chamem O Meu Advogado! / Um Bandido Bastante Morto"
    },
    {
      "numero": "78",
      "titulo": "A Lei da Marreta Biônica"
    },
    {
      "numero": "79",
      "titulo": "Os Piratas"
    },
    {
      "numero": "80",
      "titulo": "Os Piratas, Segunda Parte"
    },
    {
      "numero": "81",
      "titulo": "Irmãos Gêmeos"
    },
    {
      "numero": "82",
      "titulo": "O Louco"
    },
    {
      "numero": "83",
      "titulo": "Desativando A Bomba"
    },
    {
      "numero": "84",
      "titulo": "Desconfiança do Doutor"
    },
    {
      "numero": "85",
      "titulo": "Juleo e Rumieta - Parte 1"
    },
    {
      "numero": "86",
      "titulo": "Rumieta e Juleo - Parte 2"
    },
    {
      "numero": "87",
      "titulo": "A Construção / Atrasado Para o Jogo"
    },
    {
      "numero": "88",
      "titulo": "Uma Múmia Incomoda Muita Gente, Duas Muito Mais"
    }
  ]
    };

  const getEpisodeTitle = (program, epNumber) => {
    const list = program === "Chaves" ? episodeData.chaves_msw : episodeData.chapolin_msw;
    const match = list.find(ep => ep.numero === String(epNumber));
    return match ? match.titulo : '';
  };

  const header = document.createElement('div');
  header.className = 'channel-header';
  header.innerHTML = `
    <img src="${channel.logo}" class="channel-logo">
    <span class="channel-title">${channel.name} (Canal ${channel.channelNumber})</span>
  `;
  container.appendChild(header);

  channel.schedules.sort((a, b) => a.startTime - b.startTime);

  const filteredSchedules = channel.schedules.filter(schedule =>
    schedule.title === "Chaves" || schedule.title === "Chapolin"
  );

  const groupedByDate = {};
  filteredSchedules.forEach(schedule => {
    const start = new Date(schedule.startTime * 1000);

    // Ajuste para considerar episódios entre 0h e 5h como "do dia anterior"
    const localHour = start.toLocaleTimeString('pt-BR', {
      hour: '2-digit',
      hour12: false,
      timeZone: 'America/Sao_Paulo'
    });

    let adjustedDate = new Date(start);
    const hourNumber = parseInt(localHour, 10);

    if (hourNumber >= 0 && hourNumber < 6) {
      // Subtrai 1 dia para madrugadas
      adjustedDate.setDate(adjustedDate.getDate() - 1);
    }

    const dateKey = adjustedDate.toLocaleDateString('pt-BR', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      timeZone: 'America/Sao_Paulo'
    });

    if (!groupedByDate[dateKey]) {
      groupedByDate[dateKey] = [];
    }
    groupedByDate[dateKey].push(schedule);
  });

  // Renderização por grupo de data
  for (const [date, schedules] of Object.entries(groupedByDate)) {
    const dateGroup = document.createElement('div');
    dateGroup.className = 'date-group';

    const title = document.createElement('div');
    title.className = 'date-title';
    title.innerText = date;
    dateGroup.appendChild(title);

    const channelBox = document.createElement('div');
    channelBox.className = 'channel-group';

    schedules.forEach(schedule => {
      const sched = document.createElement('div');
      sched.className = 'schedule';

      const inicio = new Date(schedule.startTime * 1000);
      const fim = new Date(schedule.endTime * 1000);

      const diaSemana = inicio.toLocaleDateString('pt-BR', {
        weekday: 'long',
        day: 'numeric',
        month: 'long',
        timeZone: 'America/Sao_Paulo'
      });

      const horaInicio = inicio.toLocaleTimeString('pt-BR', {
        hour: '2-digit',
        minute: '2-digit',
        timeZone: 'America/Sao_Paulo'
      });

      const horaFim = fim.toLocaleTimeString('pt-BR', {
        hour: '2-digit',
        minute: '2-digit',
        timeZone: 'America/Sao_Paulo'
      });

      const epNumber = schedule.episodeNumber || '';
      const season = schedule.seasonNumber || '';
      const episodeTitle = getEpisodeTitle(schedule.title, epNumber);

      const fullTitle = `${schedule.title} - D${String(season).padStart(2, '0')}:E${String(epNumber).padStart(2, '0')} - ${episodeTitle}`;

const scheduleDay = inicio.toLocaleDateString('pt-BR', {
  day: '2-digit',
  timeZone: 'America/Sao_Paulo'
});

const expectedDay = String(season).padStart(2, '0');

let titleColor = "black";
if (scheduleDay !== expectedDay) {
  titleColor = "orange"; // Episódio fora do dia esperado
} else if (schedule.title === "Chaves") {
  titleColor = "green";
} else if (schedule.title === "Chapolin") {
  titleColor = "red";
}

      sched.innerHTML = `
        <div class="formatted-time">${diaSemana}, das ${horaInicio} às ${horaFim}</div>
        <strong><font color="${titleColor}">${fullTitle}</font></strong>
        <div class="schedule-description"><font size="2">Sinopse: ${schedule.description || 'Não disponível'}</font></div>
      `;

      sched.style.cursor = 'pointer';
      sched.addEventListener('click', () => abrirModalComDetalhes(schedule));

      if (now >= schedule.startTime && now <= schedule.endTime) {
        const progress = ((now - schedule.startTime) / (schedule.endTime - schedule.startTime)) * 100;
        const bar = document.createElement('div');
        bar.className = 'progress-bar-container';
        bar.innerHTML = `<div class="progress-bar" style="width: ${Math.round(progress)}%"></div>`;
        sched.appendChild(bar);
      }

      channelBox.appendChild(sched);
    });

    dateGroup.appendChild(channelBox);
    container.appendChild(dateGroup);
  }
}



  async function abrirModalComDetalhes(schedule) {
    try {
      // Preencher modal diretamente com os dados já recebidos
      const inicio = new Date(schedule.startTime * 1000);
      const fim = new Date(schedule.endTime * 1000);
      const formatarHora = d => d.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

      document.getElementById("modal-title").innerText = `${schedule.title} (T${schedule.seasonNumber || 1}:E${schedule.episodeNumber || 1})`;
      document.getElementById("modal-meta").innerHTML = `
        ${inicio.toLocaleDateString('pt-BR')} — ${formatarHora(inicio)} até ${formatarHora(fim)}<br>
        Duração: ${Math.round((schedule.endTime - schedule.startTime) / 60)} min<br>
        Classificação: ${schedule.rating?.code || 'N/A'} — ${schedule.rating?.descriptor?.join(', ') || ''}
      `;
      document.getElementById("modal-description").innerText = schedule.description || 'Sem descrição disponível.';
      document.getElementById("modal-header").style.backgroundImage = `url('${schedule.image.replace('{{image-size-placeholder}}', '640_360')}')`;

      document.getElementById("modal").style.display = 'flex';
    } catch (err) {
      alert('Erro ao abrir os detalhes.');
      console.error(err);
    }
  }

  fetchData();
</script>

</body>
</html>
